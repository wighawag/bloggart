{% extends "admin/base.html" %}
{% block title %}All Posts{% endblock %}
{% block body %}
<div id="main">
    <script type="text/javascript">
        function delete_post(id){
            var decision = confirm("Are you sure you want to delete this post.");
            if(decision){
                document.forms['delete_form_' + id].submit();
                return true;
            } else {
                return false;
            }
        }
    </script>
    <h1>All Posts</h1>
    {% ifnotequal last_post -1 %}
        <p>Posts {{offset|add:1}} to {{last_post|add:1}}</p>
        <table id="posts">
            <thead>
                <tr><th>Title</th><th>Published</th><th>Actions</th></tr>
            </thead>
            {% for post in posts %}
            <tr>
                <td class="title"><a href="{{config.url_prefix}}/admin/post/{{post.key.id}}">{{post.title|escape}}</a></td>
                <td class="published">{% if post.path %}{{post.published_tz|date:"Y-m-d"}}{% else %}Draft{% endif %}</td>
                <td class="actions">
                    {% if post.path %}
                      <a href="{{config.url_prefix}}{{post.path}}">View</a>
                    {% else %}
                      <a href="{{config.url_prefix}}/admin/post/preview/{{post.key.id}}">Preview</a>
                    {% endif %}
                      |
                    <a href="{{config.url_prefix}}/admin/post/{{post.key.id}}">Edit</a>
                    |
                    <form id="delete_form_{{post.key.id}}" 
                    action="{{config.url_prefix}}/admin/post/delete/{{post.key.id}}" method="post" 
                    style="display:inline;margin:0;padding:0;background:none;border:none;">
                    <a href="#" onclick="javascript:delete_post('{{post.key.id}}');">Delete</a>
                    </form>
                </td>
            </tr>
            {% endfor %}
        </table>
    {% else %}
        <p>
            No posts yet.<br />
            <a href="{{config.url_prefix}}/admin/newpost">Write your first post.</a>
        </p>
    {% endifnotequal %}
    
    {% ifnotequal offset 0 %}
        <a href="?start={{prev_offset}}&count={{count}}">&lt;- Previous</a>
    {% endifnotequal %}
  
    {% if posts|length_is:count %}
        <a href="?start={{next_offset}}&count={{count}}">Next -></a>
    {% endif %}

  <h2>Admin Actions</h2>
  <form method="post" action="{{config.url_prefix}}/admin/regenerate">
      <label for="gen_list">Available content generators:</label><br />
      <select multiple="true" id="gen_list" name="generators">
          {% for gen in generators %}
          <option selected="true">{{gen}}</option>
          {% endfor %}
      </select><br />
      <input type="submit" value="Regenerate" />
  </form>
</div>
{% endblock %}
